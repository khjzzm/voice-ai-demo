<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Voice AI Demo - ElevenLabs</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .content {
            padding: 40px;
        }

        .main-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 40px;
        }

        .section {
            margin-bottom: 40px;
            padding: 30px;
            border: 2px solid #f0f0f0;
            border-radius: 15px;
            background: #fafafa;
        }

        .full-width {
            grid-column: 1 / -1;
        }

        .section h2 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.5em;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
        }

        input[type="text"], textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        input[type="text"]:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        textarea {
            resize: vertical;
            min-height: 100px;
        }

        .file-input {
            position: relative;
            display: inline-block;
            cursor: pointer;
            background: #667eea;
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            transition: background 0.3s;
        }

        .file-input:hover {
            background: #5a6fd8;
        }

        .file-input input[type="file"] {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            cursor: pointer;
            z-index: 1;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: transform 0.2s;
        }

        .btn:hover {
            transform: translateY(-2px);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .result {
            margin-top: 20px;
            padding: 20px;
            border-radius: 8px;
            display: none;
        }

        .result.success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }

        .result.error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }

        .voice-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .voice-item {
            background: white;
            border: 1px solid #ddd;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .voice-item h3 {
            color: #333;
            margin-bottom: 10px;
        }

        .voice-item p {
            color: #666;
            margin-bottom: 15px;
        }

        .audio-player {
            width: 100%;
            margin-top: 10px;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* 반응형 디자인 */
        @media (max-width: 768px) {
            .main-grid {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .content {
                padding: 20px;
            }
            
            .section {
                padding: 20px;
                margin-bottom: 20px;
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            .header p {
                font-size: 1em;
            }
            
            /* 모바일에서 탭 버튼 세로 배치 */
            .tab-buttons {
                flex-direction: column;
            }
            
            .tab-button {
                border-radius: 0;
                border-bottom: 1px solid #dee2e6;
                font-size: 14px;
                padding: 12px 15px;
            }
            
            .tab-button:first-child {
                border-radius: 8px 8px 0 0;
            }
            
            .tab-button:last-child {
                border-radius: 0 0 8px 8px;
                border-bottom: none;
            }
            
            .tab-content {
                border-radius: 0 0 8px 8px;
                padding: 20px;
            }
        }

        /* 탭 스타일 */
        .tab-container {
            margin-bottom: 30px;
        }

        .tab-buttons {
            display: flex;
            background: #f8f9fa;
            border-radius: 8px 8px 0 0;
            overflow: hidden;
            border: 1px solid #dee2e6;
        }

        .tab-button {
            flex: 1;
            padding: 15px 20px;
            background: #f8f9fa;
            border: none;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            color: #666;
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
        }

        .tab-button:hover {
            background: #e9ecef;
            color: #495057;
        }

        .tab-button.active {
            background: white;
            color: #007bff;
            border-bottom-color: #007bff;
        }

        .tab-content {
            display: none;
            background: white;
            border: 1px solid #dee2e6;
            border-top: none;
            border-radius: 0 0 8px 8px;
            padding: 30px;
        }

        .tab-content.active {
            display: block;
        }

        /* TTS 히스토리 리스트 스타일 */
        .history-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .history-item {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .history-item h3 {
            margin: 0 0 10px 0;
            color: #333;
        }

        .history-item p {
            margin: 5px 0;
            color: #666;
        }

        .history-item .audio-controls {
            margin-top: 15px;
        }

        .history-item .btn-group {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .history-item .btn-small {
            padding: 5px 10px;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Voice AI Demo</h1>
            <p>ElevenLabs API를 사용한 음성 학습 및 TTS 서비스</p>
            <div style="background: #e3f2fd; border: 2px solid #2196f3; border-radius: 8px; padding: 15px; margin-top: 15px; font-size: 14px; color: #1565c0;">
                <strong style="color: #0d47a1;">🎤 마이크 권한 안내:</strong> Chrome에서 마이크 권한이 필요하면 <strong style="color: #d32f2f;">chrome://flags/#unsafely-treat-insecure-origin-as-secure</strong>에서 <strong style="color: #d32f2f;">http://61.80.148.182:8080/</strong>을 추가하세요.
            </div>
        </div>

        <div class="content">
            <!-- 탭 컨테이너 -->
            <div class="tab-container">
                <div class="tab-buttons">
                    <button class="tab-button active" onclick="showTab('create')">음성 모델 생성</button>
                    <button class="tab-button" onclick="showTab('default-tts')">기본 TTS</button>
                    <button class="tab-button" onclick="showTab('user-tts')">사용자 TTS</button>
                    <button class="tab-button" onclick="showTab('voices')">음성 모델 관리</button>
                    <button class="tab-button" onclick="showTab('history')">TTS 히스토리</button>
                    <button class="tab-button" onclick="showTab('account')">계정 정보</button>
                </div>

                <!-- 음성 모델 생성 탭 -->
                <div id="create-tab" class="tab-content active">
                    <div class="section full-width">
                        <h2>음성 모델 생성 가이드</h2>
                        
                        <p style="color: #666; margin-bottom: 20px;">음성 모델을 생성하는 방법과 주의사항을 안내합니다. 실제 음성 모델 생성은 "사용자 TTS" 탭에서 할 수 있습니다.</p>
                        
                        <!-- 주의사항 및 팁 박스 -->
                        <div style="background: #e3f2fd; border: 1px solid #2196f3; border-radius: 8px; padding: 15px; margin-bottom: 20px;">
                            <h4 style="color: #1976d2; margin: 0 0 10px 0;">📋 음성 모델 생성 가이드</h4>
                            <div style="font-size: 14px; color: #333;">
                                <p style="margin: 5px 0;"><strong>🎤 음성 입력 방법:</strong></p>
                                <ul style="margin: 5px 0; padding-left: 20px;">
                                    <li><strong>파일 업로드:</strong> 기존 음성 파일을 업로드하여 사용</li>
                                    <li><strong>직접 녹음:</strong> 브라우저에서 실시간으로 음성 녹음 (마이크 권한 필요)</li>
                                </ul>
                                <p style="margin: 5px 0;"><strong>✅ 권장사항:</strong></p>
                                <ul style="margin: 5px 0; padding-left: 20px;">
                                    <li>음성 파일 길이: 30초 ~ 5분 (최적: 1-3분)</li>
                                    <li>음성 품질: 깨끗하고 명확한 음성</li>
                                    <li>파일 형식: MP3, WAV, M4A (최대 100MB)</li>
                                    <li>음성 내용: 다양한 문장과 억양 포함</li>
                                </ul>
                                <p style="margin: 5px 0;"><strong>⚠️ 주의사항:</strong></p>
                                <ul style="margin: 5px 0; padding-left: 20px;">
                                    <li>배경 소음이 적은 환경에서 녹음</li>
                                    <li>일관된 음량과 톤으로 녹음</li>
                                    <li>다른 사람의 음성은 사용하지 마세요</li>
                                    <li>음성 모델 생성에는 5-10분 정도 소요</li>
                                    <li>녹음 시 브라우저에서 마이크 권한을 허용해야 합니다</li>
                                </ul>
                            </div>
                        </div>
                        
                        <!-- 실제 음성 모델 생성으로 이동 안내 -->
                        <div style="background: #e8f5e8; border: 1px solid #4caf50; border-radius: 8px; padding: 20px; margin-top: 20px; text-align: center;">
                            <h4 style="color: #388e3c; margin: 0 0 15px 0;">🎯 실제 음성 모델 생성하기</h4>
                            <p style="color: #333; margin-bottom: 15px;">위의 가이드를 참고하여 실제로 음성 모델을 생성하려면 "사용자 TTS" 탭으로 이동하세요.</p>
                            <button onclick="showTab('user-tts')" class="btn" style="background: #4caf50;">사용자 TTS 탭으로 이동</button>
                        </div>
                    </div>
                </div>

                <!-- 기본 TTS 탭 -->
                <div id="default-tts-tab" class="tab-content">
                    <div class="section full-width">
                        <h2>기본 음성 TTS 테스트</h2>
                        
                        <p style="color: #666; margin-bottom: 20px;">ElevenLabs에서 제공하는 모든 음성들로 TTS를 바로 테스트해보세요!</p>
                            
                            <!-- TTS 팁 박스 -->
                            <div style="background: #fff3e0; border: 1px solid #ff9800; border-radius: 8px; padding: 15px; margin-bottom: 20px;">
                                <h4 style="color: #f57c00; margin: 0 0 10px 0;">💡 TTS 생성 팁</h4>
                                <div style="font-size: 14px; color: #333;">
                                    <p style="margin: 5px 0;"><strong>🎯 효과적인 TTS를 위한 팁:</strong></p>
                                    <ul style="margin: 5px 0; padding-left: 20px;">
                                        <li>문장 끝에 마침표(.)를 넣으면 자연스러운 휴식</li>
                                        <li>긴 문장은 쉼표(,)로 구분하면 더 자연스러움</li>
                                        <li>한글과 영어를 혼용해도 잘 작동합니다</li>
                                        <li>감정을 표현하려면 느낌표(!) 사용</li>
                                    </ul>
                                </div>
                            </div>
                            
                            <form id="defaultVoiceForm">
                                <div class="form-group">
                                    <label for="defaultVoiceSelect">음성 선택:</label>
                                    <select id="defaultVoiceSelect" name="defaultVoiceId" required style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 16px;">
                                        <option value="">음성을 선택하세요...</option>
                                    </select>
                                    <small style="color: #666; font-size: 12px;">기본 제공 음성과 내가 생성한 음성 모두 사용 가능합니다!</small>
                                </div>
                                <div class="form-group">
                                    <label for="defaultTextToSpeech">변환할 텍스트:</label>
                                    <textarea id="defaultTextToSpeech" name="text" placeholder="음성으로 변환할 텍스트를 입력하세요 (예: 안녕하세요! 오늘 날씨가 정말 좋네요.)" required></textarea>
                                    <small style="color: #666; font-size: 12px;">한글, 영어 모두 지원됩니다. 문장 부호를 활용하면 더 자연스러운 음성이 생성됩니다.</small>
                                </div>
                                <div class="form-group">
                                    <label for="defaultFilename">파일명 (선택사항):</label>
                                    <input type="text" id="defaultFilename" name="filename" placeholder="예: my_speech.mp3" style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 16px;">
                                    <small style="color: #666; font-size: 12px;">파일명을 지정하지 않으면 기본값으로 저장됩니다.</small>
                                </div>
                                <button type="submit" class="btn">선택한 음성으로 TTS 생성</button>
                            </form>
                            <div id="defaultVoiceResult" class="result"></div>
                            <audio id="defaultGeneratedAudio" controls style="display: none; width: 100%; margin-top: 20px;"></audio>
                            <div id="defaultAudioUrl" style="display: none; margin-top: 20px;">
                                <h4>🎵 생성된 음성 URL:</h4>
                                <input type="text" id="defaultAudioUrlInput" readonly style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; background: #f9f9f9; font-size: 12px;">
                                <button onclick="copyToClipboard('defaultAudioUrlInput')" class="btn" style="margin-top: 10px; padding: 8px 16px; font-size: 14px;">URL 복사</button>
                                <button onclick="downloadDefaultAudio()" class="btn" style="margin-top: 10px; margin-left: 10px; padding: 8px 16px; font-size: 14px; background: #28a745;">MP3 다운로드</button>
                            </div>
                        </div>
                </div>

                <!-- 사용자 TTS 탭 -->
                <div id="user-tts-tab" class="tab-content">
                    <div class="main-grid">
                        <!-- 왼쪽 열: 음성 모델 생성 -->
                        <div class="section">
                            <h2>음성 모델 생성</h2>
                            
                            <!-- 주의사항 및 팁 박스 -->
                            <div style="background: #e3f2fd; border: 1px solid #2196f3; border-radius: 8px; padding: 15px; margin-bottom: 20px;">
                                <h4 style="color: #1976d2; margin: 0 0 10px 0;">📋 음성 모델 생성 가이드</h4>
                                <div style="font-size: 14px; color: #333;">
                                    <p style="margin: 5px 0;"><strong>🎤 음성 입력 방법:</strong></p>
                                    <ul style="margin: 5px 0; padding-left: 20px;">
                                        <li><strong>파일 업로드:</strong> 기존 음성 파일을 업로드하여 사용</li>
                                        <li><strong>직접 녹음:</strong> 브라우저에서 실시간으로 음성 녹음 (마이크 권한 필요)</li>
                                    </ul>
                                    <p style="margin: 5px 0;"><strong>✅ 권장사항:</strong></p>
                                    <ul style="margin: 5px 0; padding-left: 20px;">
                                        <li>음성 파일 길이: 30초 ~ 5분 (최적: 1-3분)</li>
                                        <li>음성 품질: 깨끗하고 명확한 음성</li>
                                        <li>파일 형식: MP3, WAV, M4A (최대 100MB)</li>
                                        <li>음성 내용: 다양한 문장과 억양 포함</li>
                                    </ul>
                                    <p style="margin: 5px 0;"><strong>⚠️ 주의사항:</strong></p>
                                    <ul style="margin: 5px 0; padding-left: 20px;">
                                        <li>배경 소음이 적은 환경에서 녹음</li>
                                        <li>일관된 음량과 톤으로 녹음</li>
                                        <li>다른 사람의 음성은 사용하지 마세요</li>
                                        <li>음성 모델 생성에는 5-10분 정도 소요</li>
                                        <li>녹음 시 브라우저에서 마이크 권한을 허용해야 합니다</li>
                                    </ul>
                                </div>
                            </div>
                            
                            <form id="createModelForm">
                                <div class="form-group">
                                    <label for="modelName">모델 이름:</label>
                                    <input type="text" id="modelName" name="name" placeholder="예: 내 목소리" required>
                                    <small style="color: #666; font-size: 12px;">한국어 이름을 사용하면 나중에 찾기 쉽습니다.</small>
                                </div>
                                <div class="form-group">
                                    <label for="modelLanguage">언어/지역 선택:</label>
                                    <select id="modelLanguage" name="language" style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 16px;">
                                        <option value="">언어/지역을 선택하세요</option>
                                        <option value="ko">🇰🇷 한국어 (Korean)</option>
                                        <option value="en">🇺🇸 영어 (English)</option>
                                        <option value="ja">🇯🇵 일본어 (Japanese)</option>
                                        <option value="zh">🇨🇳 중국어 (Chinese)</option>
                                        <option value="es">🇪🇸 스페인어 (Spanish)</option>
                                        <option value="fr">🇫🇷 프랑스어 (French)</option>
                                        <option value="de">🇩🇪 독일어 (German)</option>
                                        <option value="it">🇮🇹 이탈리아어 (Italian)</option>
                                        <option value="pt">🇵🇹 포르투갈어 (Portuguese)</option>
                                        <option value="ru">🇷🇺 러시아어 (Russian)</option>
                                        <option value="ar">🇸🇦 아랍어 (Arabic)</option>
                                        <option value="hi">🇮🇳 힌디어 (Hindi)</option>
                                        <option value="th">🇹🇭 태국어 (Thai)</option>
                                        <option value="vi">🇻🇳 베트남어 (Vietnamese)</option>
                                        <option value="nl">🇳🇱 네덜란드어 (Dutch)</option>
                                        <option value="sv">🇸🇪 스웨덴어 (Swedish)</option>
                                        <option value="no">🇳🇴 노르웨이어 (Norwegian)</option>
                                        <option value="da">🇩🇰 덴마크어 (Danish)</option>
                                        <option value="fi">🇫🇮 핀란드어 (Finnish)</option>
                                        <option value="pl">🇵🇱 폴란드어 (Polish)</option>
                                        <option value="tr">🇹🇷 터키어 (Turkish)</option>
                                        <option value="he">🇮🇱 히브리어 (Hebrew)</option>
                                        <option value="id">🇮🇩 인도네시아어 (Indonesian)</option>
                                        <option value="ms">🇲🇾 말레이어 (Malay)</option>
                                        <option value="fil">🇵🇭 필리핀어 (Filipino)</option>
                                        <option value="uk">🇺🇦 우크라이나어 (Ukrainian)</option>
                                        <option value="cs">🇨🇿 체코어 (Czech)</option>
                                        <option value="hu">🇭🇺 헝가리어 (Hungarian)</option>
                                        <option value="ro">🇷🇴 루마니아어 (Romanian)</option>
                                        <option value="bg">🇧🇬 불가리아어 (Bulgarian)</option>
                                        <option value="hr">🇭🇷 크로아티아어 (Croatian)</option>
                                        <option value="sk">🇸🇰 슬로바키아어 (Slovak)</option>
                                        <option value="sl">🇸🇮 슬로베니아어 (Slovenian)</option>
                                        <option value="et">🇪🇪 에스토니아어 (Estonian)</option>
                                        <option value="lv">🇱🇻 라트비아어 (Latvian)</option>
                                        <option value="lt">🇱🇹 리투아니아어 (Lithuanian)</option>
                                        <option value="el">🇬🇷 그리스어 (Greek)</option>
                                        <option value="ca">🇪🇸 카탈루냐어 (Catalan)</option>
                                        <option value="eu">🇪🇸 바스크어 (Basque)</option>
                                        <option value="gl">🇪🇸 갈리시아어 (Galician)</option>
                                        <option value="cy">🇬🇧 웨일스어 (Welsh)</option>
                                        <option value="ga">🇮🇪 아일랜드어 (Irish)</option>
                                        <option value="mt">🇲🇹 몰타어 (Maltese)</option>
                                        <option value="is">🇮🇸 아이슬란드어 (Icelandic)</option>
                                    </select>
                                    <small style="color: #666; font-size: 12px;">💡 언어를 선택하면 더 정확한 음성 모델이 생성됩니다. 한국어 음성 모델을 만들려면 한국어를 선택하세요.</small>
                                </div>
                                <div class="form-group">
                                    <label for="modelDescription">설명:</label>
                                    <textarea id="modelDescription" name="description" placeholder="음성 모델에 대한 설명을 입력하세요 (예: 내 목소리로 만든 TTS 모델)"></textarea>
                                    <small style="color: #666; font-size: 12px;">나중에 음성 모델을 구분하기 위한 설명입니다.</small>
                                </div>
                                <div class="form-group">
                                    <label>음성 입력 방법:</label>
                                    <div style="margin-bottom: 15px;">
                                        <label style="display: inline-block; margin-right: 20px;">
                                            <input type="radio" name="audioInput" value="file" checked> 파일 업로드
                                        </label>
                                        <label style="display: inline-block;">
                                            <input type="radio" name="audioInput" value="record"> 직접 녹음
                                        </label>
                                    </div>
                                    
                                    <!-- 파일 업로드 섹션 -->
                                    <div id="fileUploadSection">
                                        <label for="audioFile">음성 파일 (MP3, WAV, M4A):</label>
                                        <div class="file-input">
                                            <span>파일 선택</span>
                                            <input type="file" id="audioFile" name="audioFile" accept="audio/*" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; opacity: 0; cursor: pointer;">
                                        </div>
                                        <div id="selectedFile" style="margin-top: 10px; color: #666;"></div>
                                        <small style="color: #666; font-size: 12px;">파일 크기: 최대 100MB | 권장 길이: 1-3분</small>
                                    </div>
                                    
                                    <!-- 직접 녹음 섹션 -->
                                    <div id="recordSection" style="display: none;">
                                        <label>음성 녹음:</label>
                                        <div style="background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 8px; padding: 20px; margin-top: 10px;">
                                            
                                            <!-- 녹음 스크립트 섹션 -->
                                            <div style="margin-bottom: 20px;">
                                                <h5 style="color: #495057; margin-bottom: 10px;">📝 녹음 스크립트 (권장)</h5>
                                                <div style="background: white; border: 1px solid #ced4da; border-radius: 6px; padding: 15px; max-height: 200px; overflow-y: auto;">
                                                    <div id="scriptContent" style="font-size: 14px; line-height: 1.6; color: #333;">
                                                        <p><strong>안녕하세요! 오늘 날씨가 정말 좋네요.</strong></p>
                                                        <p>저는 인공지능 음성 모델을 만들기 위해 녹음을 하고 있습니다.</p>
                                                        <p>이 음성은 다양한 상황에서 사용될 예정입니다.</p>
                                                        <p>감사합니다! 좋은 하루 되세요.</p>
                                                    </div>
                                                </div>
                                                <div style="margin-top: 10px;">
                                                    <button type="button" id="nextScriptBtn" class="btn" style="background: #17a2b8; padding: 8px 16px; font-size: 14px; margin-right: 10px;">
                                                        다음 스크립트
                                                    </button>
                                                    <button type="button" id="customScriptBtn" class="btn" style="background: #6f42c1; padding: 8px 16px; font-size: 14px;">
                                                        직접 입력
                                                    </button>
                                                </div>
                                            </div>
                                            
                                            <div style="text-align: center; margin-bottom: 15px;">
                                                <button type="button" id="startRecordBtn" class="btn" style="background: #28a745; margin-right: 10px;">
                                                    🎤 녹음 시작
                                                </button>
                                                <button type="button" id="stopRecordBtn" class="btn" style="background: #dc3545; display: none;">
                                                    ⏹️ 녹음 중지
                                                </button>
                                            </div>
                                            <div id="recordingStatus" style="text-align: center; margin-bottom: 15px; display: none;">
                                                <div style="color: #dc3545; font-weight: bold;">🎙️ 녹음 중...</div>
                                                <div id="recordingTime" style="font-size: 18px; font-weight: bold; color: #333;">00:00</div>
                                                <div style="margin-top: 10px; font-size: 12px; color: #666;">
                                                    💡 스크립트를 따라 천천히, 명확하게 읽어주세요!
                                                </div>
                                            </div>
                                            <div id="recordedAudio" style="display: none;">
                                                <audio id="recordedAudioPlayer" controls style="width: 100%; margin-bottom: 10px;"></audio>
                                                <div style="text-align: center;">
                                                    <button type="button" id="reRecordBtn" class="btn" style="background: #6c757d; margin-right: 10px;">
                                                        🔄 다시 녹음
                                                    </button>
                                                    <button type="button" id="useRecordedBtn" class="btn" style="background: #007bff;">
                                                        ✅ 이 녹음 사용
                                                    </button>
                                                </div>
                                            </div>
                                            <small style="color: #666; font-size: 12px; display: block; margin-top: 10px;">
                                                💡 녹음 팁: 마이크 권한을 허용하고, 조용한 환경에서 1-3분 정도 녹음하세요. 스크립트를 따라 다양한 억양으로 읽으면 더 좋은 결과를 얻을 수 있습니다.
                                            </small>
                                        </div>
                                    </div>
                                </div>
                                <button type="submit" class="btn">음성 모델 생성</button>
                            </form>
                            <div id="createModelResult" class="result"></div>
                        </div>

                        <!-- 오른쪽 열: 사용자 TTS -->
                        <div class="section">
                            <h2>사용자 TTS</h2>
                            
                            <!-- 사용자 음성 TTS 가이드 -->
                            <div style="background: #f3e5f5; border: 1px solid #9c27b0; border-radius: 8px; padding: 15px; margin-bottom: 20px;">
                                <h4 style="color: #7b1fa2; margin: 0 0 10px 0;">🎤 사용자 음성 TTS 가이드</h4>
                                <div style="font-size: 14px; color: #333;">
                                    <p style="margin: 5px 0;"><strong>📝 사용 방법:</strong></p>
                                    <ol style="margin: 5px 0; padding-left: 20px;">
                                        <li>왼쪽에서 음성 모델을 먼저 생성하세요</li>
                                        <li>아래에서 생성된 음성을 선택하세요</li>
                                        <li>변환할 텍스트를 입력하고 TTS를 생성하세요</li>
                                        <li>생성된 음성을 확인하고 다운로드하세요</li>
                                    </ol>
                                    <p style="margin: 5px 0;"><strong>💡 팁:</strong> 음성 선택 시 음성 ID가 자동으로 입력됩니다. 음성 모델이 없다면 왼쪽에서 먼저 생성하세요.</p>
                                </div>
                            </div>
                            
                            <form id="generateSpeechForm">
                                <div class="form-group">
                                    <label for="userVoiceSelect">사용자 음성 선택:</label>
                                    <select id="userVoiceSelect" name="userVoiceId" style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 16px;">
                                        <option value="">사용자 음성을 선택하세요...</option>
                                    </select>
                                    <small style="color: #666; font-size: 12px;">💡 음성 선택 시 음성 ID가 자동으로 입력됩니다.</small>
                                </div>
                                <div class="form-group">
                                    <label for="voiceId">음성 ID (직접 입력):</label>
                                    <input type="text" id="voiceId" name="voiceId" placeholder="생성된 음성 모델의 ID를 입력하세요" required>
                                    <small style="color: #666; font-size: 12px;">위에서 음성을 선택하거나 직접 입력하세요.</small>
                                </div>
                                <div class="form-group">
                                    <label for="textToSpeech">변환할 텍스트:</label>
                                    <textarea id="textToSpeech" name="text" placeholder="음성으로 변환할 텍스트를 입력하세요 (예: 안녕하세요! 제 목소리로 만든 TTS입니다.)" required></textarea>
                                    <small style="color: #666; font-size: 12px;">한글, 영어 모두 지원됩니다. 문장 부호를 활용하면 더 자연스러운 음성이 생성됩니다.</small>
                                </div>
                                <div class="form-group">
                                    <label for="userFilename">파일명 (선택사항):</label>
                                    <input type="text" id="userFilename" name="filename" placeholder="예: my_voice_speech.mp3" style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 16px;">
                                    <small style="color: #666; font-size: 12px;">파일명을 지정하지 않으면 기본값으로 저장됩니다.</small>
                                </div>
                                <button type="submit" class="btn">사용자 음성으로 TTS 생성</button>
                            </form>
                            <div id="generateSpeechResult" class="result"></div>
                            <audio id="generatedAudio" controls style="display: none; width: 100%; margin-top: 20px;"></audio>
                            <div id="userAudioUrl" style="display: none; margin-top: 20px;">
                                <h4>🎵 생성된 음성 URL:</h4>
                                <input type="text" id="userAudioUrlInput" readonly style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; background: #f9f9f9; font-size: 12px;">
                                <button onclick="copyToClipboard('userAudioUrlInput')" class="btn" style="margin-top: 10px; padding: 8px 16px; font-size: 14px;">URL 복사</button>
                                <button onclick="downloadUserAudio()" class="btn" style="margin-top: 10px; margin-left: 10px; padding: 8px 16px; font-size: 14px; background: #28a745;">MP3 다운로드</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 음성 모델 관리 탭 -->
                <div id="voices-tab" class="tab-content">
                    <div class="section full-width">
                        <h2>음성 모델 관리</h2>
                        
                        <!-- 음성 목록 가이드 -->
                        <div style="background: #e8f5e8; border: 1px solid #4caf50; border-radius: 8px; padding: 15px; margin-bottom: 20px;">
                            <h4 style="color: #388e3c; margin: 0 0 10px 0;">📚 음성 모델 관리</h4>
                            <div style="font-size: 14px; color: #333;">
                                <p style="margin: 5px 0;"><strong>🔍 음성 목록 보기:</strong></p>
                                <ul style="margin: 5px 0; padding-left: 20px;">
                                    <li><strong>전체 음성 목록:</strong> ElevenLabs에서 제공하는 기본 음성과 내가 생성한 음성 모두 표시</li>
                                    <li><strong>내 음성만 보기:</strong> 내가 생성한 음성 모델만 표시 (카테고리: cloned)</li>
                                </ul>
                                <p style="margin: 5px 0;"><strong>🎯 사용 방법:</strong> 원하는 음성의 "이 음성 사용" 버튼을 클릭하면 해당 음성 ID가 자동으로 입력됩니다.</p>
                                <p style="margin: 5px 0;"><strong>🗑️ 삭제 기능:</strong> 내가 생성한 음성 모델(cloned)에만 삭제 버튼이 표시됩니다. 삭제된 음성 모델은 복구할 수 없으니 주의하세요.</p>
                            </div>
                        </div>
                        
                        <div style="margin-bottom: 20px;">
                            <button id="loadVoicesBtn" class="btn">전체 음성 목록</button>
                            <button id="loadUserVoicesBtn" class="btn" style="margin-left: 10px; background: #28a745;">내 음성만 보기</button>
                        </div>
                        <div id="voicesResult" class="result"></div>
                        <div id="voicesList" class="voice-list"></div>
                    </div>
                </div>

                <!-- TTS 히스토리 탭 -->
                <div id="history-tab" class="tab-content">
                    <div class="section full-width">
                        <h2>TTS 생성 히스토리</h2>
                        
                        <!-- 히스토리 가이드 -->
                        <div style="background: #fff8e1; border: 1px solid #ffc107; border-radius: 8px; padding: 15px; margin-bottom: 20px;">
                            <h4 style="color: #f57f17; margin: 0 0 10px 0;">📖 TTS 히스토리 관리</h4>
                            <div style="font-size: 14px; color: #333;">
                                <p style="margin: 5px 0;"><strong>📋 히스토리 기능:</strong></p>
                                <ul style="margin: 5px 0; padding-left: 20px;">
                                    <li><strong>생성된 TTS 목록:</strong> 지금까지 생성한 모든 TTS 음성 파일 확인</li>
                                    <li><strong>음성 재생:</strong> 브라우저에서 바로 음성 파일 재생 가능</li>
                                    <li><strong>MP3 다운로드:</strong> 생성된 음성 파일을 컴퓨터에 저장</li>
                                    <li><strong>파일 삭제:</strong> 더 이상 필요하지 않은 음성 파일 삭제</li>
                                </ul>
                                <p style="margin: 5px 0;"><strong>⚠️ 주의사항:</strong> ElevenLabs는 생성된 음성 파일을 일정 기간(보통 30일) 보관합니다. 중요한 파일은 반드시 다운로드해 보관하세요.</p>
                            </div>
                        </div>
                        
                        <div style="margin-bottom: 20px;">
                            <button id="loadHistoryBtn" class="btn" style="background: #17a2b8;">히스토리 불러오기</button>
                            <span style="margin-left: 15px; color: #666; font-size: 14px;">
                                💡 ElevenLabs는 생성된 음성 파일을 일정 기간 보관합니다 (보통 30일)
                            </span>
                        </div>
                        <div id="historyResult" class="result"></div>
                        <div id="historyList" class="history-list"></div>
                    </div>
                </div>

                <!-- 계정 정보 탭 -->
                <div id="account-tab" class="tab-content">
                    <div class="section full-width">
                        <h2>사용자 계정 정보</h2>
                        
                        <!-- 계정 정보 가이드 -->
                        <div style="background: #e8f4fd; border: 1px solid #0d6efd; border-radius: 8px; padding: 15px; margin-bottom: 20px;">
                            <h4 style="color: #0d6efd; margin: 0 0 10px 0;">📊 계정 사용량 및 한도</h4>
                            <div style="font-size: 14px; color: #333;">
                                <p style="margin: 5px 0;"><strong>🎯 계정 정보:</strong></p>
                                <ul style="margin: 5px 0; padding-left: 20px;">
                                    <li><strong>계정 유형:</strong> 현재 구독 플랜 확인</li>
                                    <li><strong>음성 모델 한도:</strong> 생성 가능한 음성 모델 개수</li>
                                    <li><strong>월간 사용량:</strong> 이번 달 사용한 문자 수</li>
                                    <li><strong>남은 사용량:</strong> 이번 달 남은 문자 수</li>
                                </ul>
                                <p style="margin: 5px 0;"><strong>💡 팁:</strong> 무료 계정은 월 10,000자, 유료 계정은 더 많은 한도를 제공합니다.</p>
                            </div>
                        </div>
                        
                        <div style="margin-bottom: 20px;">
                            <button id="loadUserInfoBtn" class="btn" style="background: #0d6efd;">계정 정보 불러오기</button>
                        </div>
                        <div id="userInfoResult" class="result"></div>
                        <div id="userInfoDisplay" style="display: none;">
                            <div style="background: white; border: 1px solid #dee2e6; border-radius: 8px; padding: 20px;">
                                <div id="userInfoContent"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 로딩 인디케이터 -->
            <div id="loading" class="loading">
                <div class="spinner"></div>
                <p>처리 중입니다...</p>
            </div>
        </div>
    </div>
                
            <!-- 로딩 인디케이터 -->
            <div id="loading" class="loading">
                <div class="spinner"></div>
                <p>처리 중입니다...</p>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = '/api/voice';
        
        // 탭 전환 함수
        function showTab(tabName) {
            // 모든 탭 버튼에서 active 클래스 제거
            document.querySelectorAll('.tab-button').forEach(button => {
                button.classList.remove('active');
            });
            
            // 모든 탭 콘텐츠 숨기기
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // 선택된 탭 버튼에 active 클래스 추가
            document.querySelector(`[onclick="showTab('${tabName}')"]`).classList.add('active');
            
            // 선택된 탭 콘텐츠 표시
            document.getElementById(`${tabName}-tab`).classList.add('active');
            
            // TTS 탭이 활성화되면 음성 목록 자동 로드
            if (tabName === 'default-tts' || tabName === 'user-tts') {
                loadVoicesForTTS();
            }
        }
        
        // 녹음 관련 변수들
        let mediaRecorder = null;
        let audioChunks = [];
        let recordingStartTime = null;
        let recordingTimer = null;
        let recordedBlob = null;
        
        // 스크립트 관련 변수들
        let currentScriptIndex = 0;
        const recordingScripts = [
            {
                title: "기본 인사 스크립트",
                content: `
                    <p><strong>안녕하세요! 오늘 날씨가 정말 좋네요.</strong></p>
                    <p>저는 인공지능 음성 모델을 만들기 위해 녹음을 하고 있습니다.</p>
                    <p>이 음성은 다양한 상황에서 사용될 예정입니다.</p>
                    <p>감사합니다! 좋은 하루 되세요.</p>
                `
            },
            {
                title: "다양한 억양 스크립트",
                content: `
                    <p><strong>정말 놀라워요!</strong> 오늘은 특별한 날이에요.</p>
                    <p>조용히 말할 때는 이렇게 소근소근 거려요.</p>
                    <p>반문할 때는 "정말요?" 이렇게 말해요.</p>
                    <p>기쁠 때는 "와! 대박!" 이렇게 표현해요.</p>
                `
            },
            {
                title: "일상 대화 스크립트",
                content: `
                    <p><strong>오늘 점심 뭐 먹을까요?</strong></p>
                    <p>한식이 좋을까요, 아니면 양식이 좋을까요?</p>
                    <p>저는 김치찌개를 추천해요. 정말 맛있거든요!</p>
                    <p>그럼 같이 가시죠!</p>
                `
            },
            {
                title: "감정 표현 스크립트",
                content: `
                    <p><strong>아, 너무 슬퍼요.</strong> 이런 일이 있을 줄 몰랐어요.</p>
                    <p>하지만 괜찮아요. 언젠가는 좋아질 거예요.</p>
                    <p>힘내세요! 당신은 충분히 잘하고 있어요.</p>
                    <p>함께 이겨내요!</p>
                `
            },
            {
                title: "전문적 톤 스크립트",
                content: `
                    <p><strong>안녕하십니까. 오늘 회의를 시작하겠습니다.</strong></p>
                    <p>첫 번째 안건은 프로젝트 진행 상황에 대한 보고입니다.</p>
                    <p>모든 팀원들의 협력 덕분에 순조롭게 진행되고 있습니다.</p>
                    <p>감사합니다.</p>
                `
            }
        ];

        // 음성 입력 방법 변경 이벤트
        document.querySelectorAll('input[name="audioInput"]').forEach(radio => {
            radio.addEventListener('change', function() {
                if (this.value === 'file') {
                    document.getElementById('fileUploadSection').style.display = 'block';
                    document.getElementById('recordSection').style.display = 'none';
                    document.getElementById('audioFile').required = true;
                } else {
                    document.getElementById('fileUploadSection').style.display = 'none';
                    document.getElementById('recordSection').style.display = 'block';
                    document.getElementById('audioFile').required = false;
                }
            });
        });

        // 파일 선택 시 파일명 표시
        document.getElementById('audioFile').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                document.getElementById('selectedFile').textContent = `선택된 파일: ${file.name}`;
            }
        });

        // 녹음 시작
        document.getElementById('startRecordBtn').addEventListener('click', async function() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                mediaRecorder = new MediaRecorder(stream);
                audioChunks = [];
                
                mediaRecorder.ondataavailable = function(event) {
                    audioChunks.push(event.data);
                };
                
                mediaRecorder.onstop = function() {
                    recordedBlob = new Blob(audioChunks, { type: 'audio/wav' });
                    const audioUrl = URL.createObjectURL(recordedBlob);
                    document.getElementById('recordedAudioPlayer').src = audioUrl;
                    document.getElementById('recordedAudio').style.display = 'block';
                    document.getElementById('recordingStatus').style.display = 'none';
                    document.getElementById('startRecordBtn').style.display = 'inline-block';
                    document.getElementById('stopRecordBtn').style.display = 'none';
                    
                    // 스크립트 스타일 원복
                    document.getElementById('scriptContent').style.cssText = 'font-size: 14px; line-height: 1.6; color: #333;';
                    
                    // 타이머 정리
                    if (recordingTimer) {
                        clearInterval(recordingTimer);
                        recordingTimer = null;
                    }
                    
                    // 스트림 정리
                    stream.getTracks().forEach(track => track.stop());
                };
                
                mediaRecorder.start();
                recordingStartTime = Date.now();
                
                // UI 업데이트
                document.getElementById('startRecordBtn').style.display = 'none';
                document.getElementById('stopRecordBtn').style.display = 'inline-block';
                document.getElementById('recordingStatus').style.display = 'block';
                document.getElementById('recordedAudio').style.display = 'none';
                
                // 스크립트 강조 표시
                document.getElementById('scriptContent').style.cssText = 'font-size: 14px; line-height: 1.6; color: #333; background: #fff3cd; border: 2px solid #ffc107; border-radius: 4px; padding: 10px;';
                
                // 녹음 시간 타이머
                recordingTimer = setInterval(updateRecordingTime, 1000);
                
            } catch (error) {
                alert('마이크 권한이 필요합니다!\n\n해결 방법:\n1. chrome://flags/#unsafely-treat-insecure-origin-as-secure 접속\n2. "Insecure origins treated as secure" 설정을 "Enabled"로 변경\n3. "Add" 버튼 클릭 후 "http://61.80.148.182:8080/" 추가\n4. Chrome 재시작 후 다시 시도하세요');
                console.error('녹음 시작 실패:', error);
            }
        });
        
        // 녹음 중지
        document.getElementById('stopRecordBtn').addEventListener('click', function() {
            if (mediaRecorder && mediaRecorder.state === 'recording') {
                mediaRecorder.stop();
            }
        });
        
        // 다시 녹음
        document.getElementById('reRecordBtn').addEventListener('click', function() {
            document.getElementById('recordedAudio').style.display = 'none';
            document.getElementById('startRecordBtn').style.display = 'inline-block';
            recordedBlob = null;
        });
        
        // 다음 스크립트 버튼
        document.getElementById('nextScriptBtn').addEventListener('click', function() {
            currentScriptIndex = (currentScriptIndex + 1) % recordingScripts.length;
            updateScriptDisplay();
        });
        
        // 직접 입력 버튼
        document.getElementById('customScriptBtn').addEventListener('click', function() {
            const customScript = prompt('녹음할 스크립트를 입력하세요:\n\n(여러 줄로 입력 가능합니다)', 
                '안녕하세요! 오늘은 정말 좋은 날씨네요.\n저는 음성 모델을 만들기 위해 녹음을 하고 있습니다.\n감사합니다!');
            
            if (customScript && customScript.trim()) {
                const scriptContent = customScript.split('\n').map(line => 
                    `<p>${line.trim()}</p>`
                ).join('');
                
                document.getElementById('scriptContent').innerHTML = scriptContent;
                document.getElementById('nextScriptBtn').textContent = '기본 스크립트로';
                document.getElementById('nextScriptBtn').onclick = function() {
                    currentScriptIndex = 0;
                    updateScriptDisplay();
                    this.textContent = '다음 스크립트';
                    this.onclick = arguments.callee;
                };
            }
        });
        
        // 스크립트 표시 업데이트
        function updateScriptDisplay() {
            const script = recordingScripts[currentScriptIndex];
            document.getElementById('scriptContent').innerHTML = script.content;
            
            // 스크립트 제목 표시 (선택사항)
            const scriptTitle = document.createElement('div');
            scriptTitle.style.cssText = 'font-size: 12px; color: #666; margin-bottom: 10px; font-style: italic;';
            scriptTitle.textContent = script.title;
            
            const scriptContent = document.getElementById('scriptContent');
            scriptContent.insertBefore(scriptTitle, scriptContent.firstChild);
        }
        
        // 녹음된 음성 사용
        document.getElementById('useRecordedBtn').addEventListener('click', function() {
            if (recordedBlob) {
                // 파일 입력에 녹음된 음성 설정
                const file = new File([recordedBlob], 'recorded_audio.wav', { type: 'audio/wav' });
                const dataTransfer = new DataTransfer();
                dataTransfer.items.add(file);
                document.getElementById('audioFile').files = dataTransfer.files;
                document.getElementById('selectedFile').textContent = `선택된 파일: 녹음된 음성 (${formatTime(Math.floor(recordedBlob.size / 16000))})`;
                
                // 파일 업로드 모드로 전환
                document.querySelector('input[name="audioInput"][value="file"]').checked = true;
                document.getElementById('fileUploadSection').style.display = 'block';
                document.getElementById('recordSection').style.display = 'none';
                document.getElementById('audioFile').required = true;
            }
        });
        
        // 녹음 시간 업데이트
        function updateRecordingTime() {
            if (recordingStartTime) {
                const elapsed = Math.floor((Date.now() - recordingStartTime) / 1000);
                const minutes = Math.floor(elapsed / 60);
                const seconds = elapsed % 60;
                document.getElementById('recordingTime').textContent = 
                    `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            }
        }
        
        // 시간 포맷팅
        function formatTime(seconds) {
            const minutes = Math.floor(seconds / 60);
            const remainingSeconds = seconds % 60;
            return `${minutes}분 ${remainingSeconds}초`;
        }

        // 음성 모델 생성
        document.getElementById('createModelForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            showLoading(true);

            const formData = new FormData();
            formData.append('name', document.getElementById('modelName').value);
            formData.append('description', document.getElementById('modelDescription').value);
            
            // 언어 정보 추가
            const language = document.getElementById('modelLanguage').value;
            if (language) {
                formData.append('language', language);
            }
            
            // 음성 입력 방법에 따라 파일 추가
            const audioInput = document.querySelector('input[name="audioInput"]:checked').value;
            if (audioInput === 'file') {
                const audioFile = document.getElementById('audioFile').files[0];
                if (!audioFile) {
                    showResult('createModelResult', false, '음성 파일을 선택하거나 녹음해주세요.');
                    showLoading(false);
                    return;
                }
                formData.append('audioFile', audioFile);
            } else if (audioInput === 'record' && recordedBlob) {
                const file = new File([recordedBlob], 'recorded_audio.wav', { type: 'audio/wav' });
                formData.append('audioFile', file);
            } else {
                showResult('createModelResult', false, '음성을 녹음해주세요.');
                showLoading(false);
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/create-model`, {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();
                showResult('createModelResult', result.success, result.message);
                
                if (result.success) {
                    document.getElementById('voiceId').value = result.voiceId;
                    // 목록 자동 새로고침 제거 - 사용자가 필요시에만 새로고침 버튼 사용
                }
            } catch (error) {
                showResult('createModelResult', false, '오류가 발생했습니다: ' + error.message);
            } finally {
                showLoading(false);
            }
        });

        // 기본 음성 TTS 생성
        document.getElementById('defaultVoiceForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            showLoading(true);

            const formData = new FormData();
            formData.append('voiceId', document.getElementById('defaultVoiceSelect').value);
            formData.append('text', document.getElementById('defaultTextToSpeech').value);

            try {
                const response = await fetch(`${API_BASE}/generate-speech`, {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();
                
                if (result.success) {
                    // 오디오 플레이어 설정
                    const audio = document.getElementById('defaultGeneratedAudio');
                    audio.src = result.audioUrl;
                    audio.style.display = 'block';
                    
                    // URL 표시
                    const urlInput = document.getElementById('defaultAudioUrlInput');
                    urlInput.value = result.audioUrl;
                    document.getElementById('defaultAudioUrl').style.display = 'block';
                    
                    // 전역 변수에 저장 (다운로드용)
                    window.defaultAudioData = result.audioData;
                    window.defaultAudioFilename = document.getElementById('defaultFilename').value || 'default_speech.mp3';
                    
                    showResult('defaultVoiceResult', true, '기본 음성으로 TTS가 성공적으로 생성되었습니다!');
                } else {
                    showResult('defaultVoiceResult', false, result.message || '기본 음성 TTS 생성에 실패했습니다.');
                }
            } catch (error) {
                showResult('defaultVoiceResult', false, '오류가 발생했습니다: ' + error.message);
            } finally {
                showLoading(false);
            }
        });

        // 사용자 음성 TTS 생성
        document.getElementById('generateSpeechForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            showLoading(true);

            const formData = new FormData();
            formData.append('voiceId', document.getElementById('voiceId').value);
            formData.append('text', document.getElementById('textToSpeech').value);

            try {
                const response = await fetch(`${API_BASE}/generate-speech`, {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();
                
                if (result.success) {
                    // 오디오 플레이어 설정
                    const audio = document.getElementById('generatedAudio');
                    audio.src = result.audioUrl;
                    audio.style.display = 'block';
                    
                    // URL 표시
                    const urlInput = document.getElementById('userAudioUrlInput');
                    urlInput.value = result.audioUrl;
                    document.getElementById('userAudioUrl').style.display = 'block';
                    
                    // 전역 변수에 저장 (다운로드용)
                    window.userAudioData = result.audioData;
                    window.userAudioFilename = document.getElementById('userFilename').value || 'user_speech.mp3';
                    
                    showResult('generateSpeechResult', true, '사용자 음성으로 TTS가 성공적으로 생성되었습니다!');
                } else {
                    showResult('generateSpeechResult', false, result.message || '사용자 음성 TTS 생성에 실패했습니다.');
                }
            } catch (error) {
                showResult('generateSpeechResult', false, '오류가 발생했습니다: ' + error.message);
            } finally {
                showLoading(false);
            }
        });

        // 음성 목록 로드 (기본 음성과 사용자 음성 모두)
        loadVoices();

        // TTS 탭이 활성화될 때 음성 목록 자동 로드
        function loadVoicesForTTS() {
            const voiceSelect = document.getElementById('defaultVoiceSelect');
            const userVoiceSelect = document.getElementById('userVoiceSelect');
            if (voiceSelect.children.length <= 1 || userVoiceSelect.children.length <= 1) { // 옵션이 1개 이하일 때만 로드
                loadVoices();
            }
        }

        // 전체 음성 목록 버튼
        document.getElementById('loadVoicesBtn').addEventListener('click', function() {
            showResult('voicesResult', true, '전체 음성 목록을 불러왔습니다.');
            loadVoices();
        });

        // 사용자 음성만 보기 버튼
        document.getElementById('loadUserVoicesBtn').addEventListener('click', function() {
            showResult('voicesResult', true, '내가 생성한 음성 목록을 불러왔습니다.');
            loadUserVoices();
        });

        // 사용자 음성 선택 드롭다운 이벤트
        document.getElementById('userVoiceSelect').addEventListener('change', function() {
            const selectedVoiceId = this.value;
            if (selectedVoiceId) {
                document.getElementById('voiceId').value = selectedVoiceId;
            }
        });

        // 사용자 계정 정보 불러오기 버튼
        document.getElementById('loadUserInfoBtn').addEventListener('click', function() {
            showResult('userInfoResult', true, '사용자 계정 정보를 불러왔습니다.');
            loadUserInfo();
        });

        // TTS 히스토리 불러오기 버튼
        document.getElementById('loadHistoryBtn').addEventListener('click', function() {
            showResult('historyResult', true, 'TTS 생성 히스토리를 불러왔습니다.');
            loadTtsHistory();
        });

        async function loadVoices() {
            showLoading(true);
            try {
                const response = await fetch(`${API_BASE}/voices`);
                const voices = await response.json();
            
                
                // 음성 모델 목록 업데이트
                const voicesList = document.getElementById('voicesList');
                voicesList.innerHTML = '';

                if (voices.voices && voices.voices.length > 0) {
                    voices.voices.forEach(voice => {
                        const voiceItem = document.createElement('div');
                        voiceItem.className = 'voice-item';
                        
                        // 사용자가 생성한 음성인 경우에만 삭제 버튼 표시
                        const isUserVoice = voice.category === 'cloned';
                        const buttonHtml = isUserVoice 
                            ? `<div style="display: flex; gap: 10px; margin-top: 10px;">
                                 <button class="btn" onclick="useVoice('${voice.voice_id}')" style="flex: 1;">이 음성 사용</button>
                                 <button class="btn" onclick="deleteVoice('${voice.voice_id}', '${voice.name}')" style="background: #dc3545; flex: 1;">삭제</button>
                               </div>`
                            : `<button class="btn" onclick="useVoice('${voice.voice_id}')" style="margin-top: 10px;">이 음성 사용</button>`;
                        
                        // 설명 필드 찾기 (여러 가능한 위치 확인)
                        let description = '설명 없음';
                        if (voice.labels && voice.labels.description) {
                            description = voice.labels.description;
                        } else if (voice.description) {
                            description = voice.description;
                        } else if (voice.labels && voice.labels.accent) {
                            description = voice.labels.accent;
                        }
                        
                        // 언어 정보 표시
                        let languageInfo = '';
                        if (voice.labels && voice.labels.language) {
                            const languageCode = voice.labels.language;
                            const languageNames = {
                                'ko': '🇰🇷 한국어', 'en': '🇺🇸 영어', 'ja': '🇯🇵 일본어', 'zh': '🇨🇳 중국어',
                                'es': '🇪🇸 스페인어', 'fr': '🇫🇷 프랑스어', 'de': '🇩🇪 독일어', 'it': '🇮🇹 이탈리아어',
                                'pt': '🇵🇹 포르투갈어', 'ru': '🇷🇺 러시아어', 'ar': '🇸🇦 아랍어', 'hi': '🇮🇳 힌디어',
                                'th': '🇹🇭 태국어', 'vi': '🇻🇳 베트남어', 'nl': '🇳🇱 네덜란드어', 'sv': '🇸🇪 스웨덴어',
                                'no': '🇳🇴 노르웨이어', 'da': '🇩🇰 덴마크어', 'fi': '🇫🇮 핀란드어', 'pl': '🇵🇱 폴란드어',
                                'tr': '🇹🇷 터키어', 'he': '🇮🇱 히브리어', 'id': '🇮🇩 인도네시아어', 'ms': '🇲🇾 말레이어',
                                'fil': '🇵🇭 필리핀어', 'uk': '🇺🇦 우크라이나어', 'cs': '🇨🇿 체코어', 'hu': '🇭🇺 헝가리어',
                                'ro': '🇷🇴 루마니아어', 'bg': '🇧🇬 불가리아어', 'hr': '🇭🇷 크로아티아어', 'sk': '🇸🇰 슬로바키아어',
                                'sl': '🇸🇮 슬로베니아어', 'et': '🇪🇪 에스토니아어', 'lv': '🇱🇻 라트비아어', 'lt': '🇱🇹 리투아니아어',
                                'el': '🇬🇷 그리스어', 'ca': '🇪🇸 카탈루냐어', 'eu': '🇪🇸 바스크어', 'gl': '🇪🇸 갈리시아어',
                                'cy': '🇬🇧 웨일스어', 'ga': '🇮🇪 아일랜드어', 'mt': '🇲🇹 몰타어', 'is': '🇮🇸 아이슬란드어'
                            };
                            languageInfo = `<p><strong>언어:</strong> ${languageNames[languageCode] || languageCode}</p>`;
                        }
                        
                        voiceItem.innerHTML = `
                            <h3>${voice.name}</h3>
                            <p><strong>ID:</strong> ${voice.voice_id}</p>
                            <p><strong>설명:</strong> ${description}</p>
                            <p><strong>카테고리:</strong> ${voice.category || '사용자 정의'}</p>
                            ${languageInfo}
                            ${buttonHtml}
                        `;
                        voicesList.appendChild(voiceItem);
                    });
                } else {
                    voicesList.innerHTML = '<p>사용 가능한 음성 모델이 없습니다.</p>';
                }

                // 기본 음성 드롭다운 업데이트 (모든 음성 표시)
                const voiceSelect = document.getElementById('defaultVoiceSelect');
                voiceSelect.innerHTML = '<option value="">음성을 선택하세요...</option>';

                // 사용자 음성 드롭다운 업데이트 (사용자 생성 음성만 필터링)
                const userVoiceSelect = document.getElementById('userVoiceSelect');
                userVoiceSelect.innerHTML = '<option value="">사용자 음성을 선택하세요...</option>';

                if (voices.voices && voices.voices.length > 0) {
                    voices.voices.forEach(voice => {
                        // 모든 음성을 기본 음성 드롭다운에 표시
                        const option = document.createElement('option');
                        option.value = voice.voice_id;
                        
                        // 언어 정보 추가
                        let languageInfo = '';
                        if (voice.labels && voice.labels.language) {
                            const languageCode = voice.labels.language;
                            const languageNames = {
                                'ko': '🇰🇷', 'en': '🇺🇸', 'ja': '🇯🇵', 'zh': '🇨🇳',
                                'es': '🇪🇸', 'fr': '🇫🇷', 'de': '🇩🇪', 'it': '🇮🇹',
                                'pt': '🇵🇹', 'ru': '🇷🇺', 'ar': '🇸🇦', 'hi': '🇮🇳',
                                'th': '🇹🇭', 'vi': '🇻🇳', 'nl': '🇳🇱', 'sv': '🇸🇪',
                                'no': '🇳🇴', 'da': '🇩🇰', 'fi': '🇫🇮', 'pl': '🇵🇱',
                                'tr': '🇹🇷', 'he': '🇮🇱', 'id': '🇮🇩', 'ms': '🇲🇾',
                                'fil': '🇵🇭', 'uk': '🇺🇦', 'cs': '🇨🇿', 'hu': '🇭🇺',
                                'ro': '🇷🇴', 'bg': '🇧🇬', 'hr': '🇭🇷', 'sk': '🇸🇰',
                                'sl': '🇸🇮', 'et': '🇪🇪', 'lv': '🇱🇻', 'lt': '🇱🇹',
                                'el': '🇬🇷', 'ca': '🇪🇸', 'eu': '🇪🇸', 'gl': '🇪🇸',
                                'cy': '🇬🇧', 'ga': '🇮🇪', 'mt': '🇲🇹', 'is': '🇮🇸'
                            };
                            languageInfo = ` ${languageNames[languageCode] || languageCode}`;
                        }
                        
                        // 카테고리에 따라 다른 표시
                        if (voice.category === 'cloned') {
                            option.textContent = `${voice.name}${languageInfo} (내 음성)`;
                        } else {
                            option.textContent = `${voice.name}${languageInfo} (${voice.category || '기본'})`;
                        }
                        
                        voiceSelect.appendChild(option);
                        
                        // 사용자 생성 음성만 별도 드롭다운에도 추가
                        if (voice.category === 'cloned') {
                            const userOption = document.createElement('option');
                            userOption.value = voice.voice_id;
                            userOption.textContent = `${voice.name}${languageInfo} (내 음성)`;
                            userVoiceSelect.appendChild(userOption);
                        }
                    });
                }
            } catch (error) {
                console.error('음성 목록 로드 실패:', error);
            } finally {
                showLoading(false);
            }
        }

        async function loadUserInfo() {
            showLoading(true);
            try {
                const response = await fetch(`${API_BASE}/user-info`);
                const userInfo = await response.json();
                
                const userInfoContent = document.getElementById('userInfoContent');
                userInfoContent.innerHTML = '';
                
                // 계정 정보 표시
                const infoHtml = `
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 8px;">
                            <h4 style="color: #495057; margin: 0 0 10px 0;">👤 계정 정보</h4>
                            <p><strong>계정 유형:</strong> ${userInfo.subscription?.tier || '무료'}</p>
                            <p><strong>가입일:</strong> ${userInfo.subscription?.created_at ? new Date(userInfo.subscription.created_at * 1000).toLocaleDateString() : '알 수 없음'}</p>
                            <p><strong>다음 결제일:</strong> ${userInfo.subscription?.next_character_count_reset_unix ? new Date(userInfo.subscription.next_character_count_reset_unix * 1000).toLocaleDateString() : '알 수 없음'}</p>
                        </div>
                        
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 8px;">
                            <h4 style="color: #495057; margin: 0 0 10px 0;">🎤 음성 모델</h4>
                            <p><strong>생성된 음성 모델:</strong> ${userInfo.subscription?.voice_limit || '알 수 없음'}개</p>
                            <p><strong>음성 모델 한도:</strong> ${userInfo.subscription?.can_extend_voice_limit ? '확장 가능' : '한도 도달'}</p>
                            <p><strong>음성 모델 삭제:</strong> ${userInfo.subscription?.can_use_instant_voice_cloning ? '가능' : '불가능'}</p>
                        </div>
                        
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 8px;">
                            <h4 style="color: #495057; margin: 0 0 10px 0;">📊 사용량</h4>
                            <p><strong>이번 달 사용:</strong> ${userInfo.subscription?.character_count || 0}자</p>
                            <p><strong>이번 달 한도:</strong> ${userInfo.subscription?.character_limit || 0}자</p>
                            <p><strong>남은 사용량:</strong> ${(userInfo.subscription?.character_limit || 0) - (userInfo.subscription?.character_count || 0)}자</p>
                        </div>
                        
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 8px;">
                            <h4 style="color: #495057; margin: 0 0 10px 0;">💡 한도 정보</h4>
                            <p><strong>무료 계정:</strong> 월 10,000자</p>
                            <p><strong>Starter:</strong> 월 30,000자</p>
                            <p><strong>Creator:</strong> 월 250,000자</p>
                            <p><strong>Independent Publisher:</strong> 월 1,000,000자</p>
                            <p><strong>Growing Business:</strong> 월 2,500,000자</strong></p>
                        </div>
                    </div>
                    
                    <div style="margin-top: 20px; padding: 15px; background: #e7f3ff; border-radius: 8px;">
                        <h5 style="color: #0d6efd; margin: 0 0 10px 0;">📋 ElevenLabs 플랜별 음성 모델 한도</h5>
                        <ul style="margin: 0; padding-left: 20px; color: #333;">
                            <li><strong>무료:</strong> 음성 모델 생성 불가</li>
                            <li><strong>Starter ($22/월):</strong> 최대 10개 음성 모델</li>
                            <li><strong>Creator ($99/월):</strong> 최대 30개 음성 모델</li>
                            <li><strong>Independent Publisher ($330/월):</strong> 최대 100개 음성 모델</li>
                            <li><strong>Growing Business ($825/월):</strong> 최대 250개 음성 모델</li>
                        </ul>
                    </div>
                `;
                
                userInfoContent.innerHTML = infoHtml;
                document.getElementById('userInfoDisplay').style.display = 'block';
                
            } catch (error) {
                console.error('사용자 정보 로드 실패:', error);
                showResult('userInfoResult', false, '사용자 정보 로드에 실패했습니다: ' + error.message);
            } finally {
                showLoading(false);
            }
        }

        async function loadUserVoices() {
            showLoading(true);
            try {
                const response = await fetch(`${API_BASE}/user-voices`);
                const voices = await response.json();
                
                // 사용자 음성 모델 목록 업데이트
                const voicesList = document.getElementById('voicesList');
                voicesList.innerHTML = '';

                if (voices.voices && voices.voices.length > 0) {
                    // 사용자 생성 음성만 필터링 (category가 'cloned'인 것들)
                    const userVoices = voices.voices.filter(voice => voice.category === 'cloned');
                    
                    if (userVoices.length > 0) {
                        userVoices.forEach(voice => {
                            const voiceItem = document.createElement('div');
                            voiceItem.className = 'voice-item';
                            
                            // 설명 필드 찾기 (여러 가능한 위치 확인)
                            let description = '설명 없음';
                            if (voice.labels && voice.labels.description) {
                                description = voice.labels.description;
                            } else if (voice.description) {
                                description = voice.description;
                            } else if (voice.labels && voice.labels.accent) {
                                description = voice.labels.accent;
                            }
                            
                            // 언어 정보 표시
                            let languageInfo = '';
                            if (voice.labels && voice.labels.language) {
                                const languageCode = voice.labels.language;
                                const languageNames = {
                                    'ko': '🇰🇷 한국어', 'en': '🇺🇸 영어', 'ja': '🇯🇵 일본어', 'zh': '🇨🇳 중국어',
                                    'es': '🇪🇸 스페인어', 'fr': '🇫🇷 프랑스어', 'de': '🇩🇪 독일어', 'it': '🇮🇹 이탈리아어',
                                    'pt': '🇵🇹 포르투갈어', 'ru': '🇷🇺 러시아어', 'ar': '🇸🇦 아랍어', 'hi': '🇮🇳 힌디어',
                                    'th': '🇹🇭 태국어', 'vi': '🇻🇳 베트남어', 'nl': '🇳🇱 네덜란드어', 'sv': '🇸🇪 스웨덴어',
                                    'no': '🇳🇴 노르웨이어', 'da': '🇩🇰 덴마크어', 'fi': '🇫🇮 핀란드어', 'pl': '🇵🇱 폴란드어',
                                    'tr': '🇹🇷 터키어', 'he': '🇮🇱 히브리어', 'id': '🇮🇩 인도네시아어', 'ms': '🇲🇾 말레이어',
                                    'fil': '🇵🇭 필리핀어', 'uk': '🇺🇦 우크라이나어', 'cs': '🇨🇿 체코어', 'hu': '🇭🇺 헝가리어',
                                    'ro': '🇷🇴 루마니아어', 'bg': '🇧🇬 불가리아어', 'hr': '🇭🇷 크로아티아어', 'sk': '🇸🇰 슬로바키아어',
                                    'sl': '🇸🇮 슬로베니아어', 'et': '🇪🇪 에스토니아어', 'lv': '🇱🇻 라트비아어', 'lt': '🇱🇹 리투아니아어',
                                    'el': '🇬🇷 그리스어', 'ca': '🇪🇸 카탈루냐어', 'eu': '🇪🇸 바스크어', 'gl': '🇪🇸 갈리시아어',
                                    'cy': '🇬🇧 웨일스어', 'ga': '🇮🇪 아일랜드어', 'mt': '🇲🇹 몰타어', 'is': '🇮🇸 아이슬란드어'
                                };
                                languageInfo = `<p><strong>언어:</strong> ${languageNames[languageCode] || languageCode}</p>`;
                            }
                            
                            voiceItem.innerHTML = `
                                <h3>${voice.name}</h3>
                                <p><strong>ID:</strong> ${voice.voice_id}</p>
                                <p><strong>설명:</strong> ${description}</p>
                                <p><strong>카테고리:</strong> ${voice.category || '사용자 정의'}</p>
                                ${languageInfo}
                                <div style="display: flex; gap: 10px; margin-top: 10px;">
                                    <button class="btn" onclick="useVoice('${voice.voice_id}')" style="flex: 1;">이 음성 사용</button>
                                    <button class="btn" onclick="deleteVoice('${voice.voice_id}', '${voice.name}')" style="background: #dc3545; flex: 1;">삭제</button>
                                </div>
                            `;
                            voicesList.appendChild(voiceItem);
                        });
                    } else {
                        voicesList.innerHTML = '<p>아직 생성한 음성 모델이 없습니다. 위에서 음성 모델을 생성해보세요!</p>';
                    }
                } else {
                    voicesList.innerHTML = '<p>아직 생성한 음성 모델이 없습니다. 위에서 음성 모델을 생성해보세요!</p>';
                }
            } catch (error) {
                console.error('사용자 음성 목록 로드 실패:', error);
            } finally {
                showLoading(false);
            }
        }

        // 음성 ID 자동 입력
        function useVoice(voiceId) {
            document.getElementById('voiceId').value = voiceId;
            document.getElementById('voiceId').scrollIntoView({ behavior: 'smooth' });
        }

        // 결과 표시
        function showResult(elementId, success, message) {
            const element = document.getElementById(elementId);
            element.className = `result ${success ? 'success' : 'error'}`;
            element.textContent = message;
            element.style.display = 'block';
            
            setTimeout(() => {
                element.style.display = 'none';
            }, 5000);
        }

        // 로딩 표시/숨김
        function showLoading(show) {
            document.getElementById('loading').style.display = show ? 'block' : 'none';
        }

        // URL 복사 기능
        function copyToClipboard(elementId) {
            const element = document.getElementById(elementId);
            element.select();
            element.setSelectionRange(0, 99999); // 모바일용
            document.execCommand('copy');
            
            // 복사 완료 메시지
            const originalText = element.value;
            element.value = 'URL이 클립보드에 복사되었습니다!';
            setTimeout(() => {
                element.value = originalText;
            }, 2000);
        }

        // 기본 음성 MP3 다운로드
        function downloadDefaultAudio() {
            if (window.defaultAudioData) {
                const byteCharacters = atob(window.defaultAudioData);
                const byteNumbers = new Array(byteCharacters.length);
                for (let i = 0; i < byteCharacters.length; i++) {
                    byteNumbers[i] = byteCharacters.charCodeAt(i);
                }
                const byteArray = new Uint8Array(byteNumbers);
                const blob = new Blob([byteArray], { type: 'audio/mpeg' });
                
                const link = document.createElement('a');
                link.href = URL.createObjectURL(blob);
                link.download = window.defaultAudioFilename;
                link.click();
            }
        }

        // 사용자 음성 MP3 다운로드
        function downloadUserAudio() {
            if (window.userAudioData) {
                const byteCharacters = atob(window.userAudioData);
                const byteNumbers = new Array(byteCharacters.length);
                for (let i = 0; i < byteCharacters.length; i++) {
                    byteNumbers[i] = byteCharacters.charCodeAt(i);
                }
                const byteArray = new Uint8Array(byteNumbers);
                const blob = new Blob([byteArray], { type: 'audio/mpeg' });
                
                const link = document.createElement('a');
                link.href = URL.createObjectURL(blob);
                link.download = window.userAudioFilename;
                link.click();
            }
        }

        // 페이지 로드 시 음성 목록 로드
        window.addEventListener('load', loadVoices);

        async function loadTtsHistory() {
            showLoading(true);
            try {
                const response = await fetch(`${API_BASE}/history`);
                const historyList = document.getElementById('historyList');
                historyList.innerHTML = '';

                if (response.ok) {
                    // 응답 본문이 비어있지 않은 경우만 json 파싱
                    const text = await response.text();
                    if (text) {
                        const history = JSON.parse(text);
                        
                        // 응답 구조에 맞게 처리
                        let historyArray = [];
                        if (history.history && history.history.history) {
                            // { "history": { "history": [...], "last_history_item_id": "...", "has_more": false } }
                            historyArray = history.history.history;
                        } else if (history.history && Array.isArray(history.history)) {
                            // { "history": [...] }
                            historyArray = history.history;
                        } else if (Array.isArray(history)) {
                            // [...] 직접 배열
                            historyArray = history;
                        }
                        
                        if (historyArray && historyArray.length > 0) {
                            historyArray.forEach(item => {
                                // 오디오 URL 생성 (프록시를 통한 다운로드)
                                const audioUrl = `${API_BASE}/history/${item.history_item_id}/audio`;
                                
                                // 텍스트 디코딩 (한글 깨짐 방지)
                                let displayText = item.text || '';
                                
                                // dialogue가 있는 경우 텍스트 추출
                                if (!displayText && item.dialogue && item.dialogue.length > 0) {
                                    displayText = item.dialogue.map(d => d.text).join(' ');
                                }
                                
                                const historyItem = document.createElement('div');
                                historyItem.className = 'history-item';
                                historyItem.innerHTML = `
                                    <h3>${item.voice_name || '음성 이름 없음'}</h3>
                                    <p><strong>생성일:</strong> ${new Date(item.date_unix * 1000).toLocaleString()}</p>
                                    <div class="audio-controls">
                                        <audio controls src="${audioUrl}" style="width: 100%;"></audio>
                                    </div>
                                    <div class="btn-group">
                                        <a href="${audioUrl}" download class="btn btn-small" style="background: #28a745;">MP3 다운로드</a>
                                        <button class="btn btn-small" style="background: #dc3545;" onclick="deleteTtsHistoryItem('${item.history_item_id}')">삭제</button>
                                    </div>
                                `;
                                historyList.appendChild(historyItem);
                            });
                        } else {
                            historyList.innerHTML = '<p>생성된 TTS 히스토리가 없습니다.</p>';
                        }
                    } else {
                        historyList.innerHTML = '<p>생성된 TTS 히스토리가 없습니다.</p>';
                    }
                } else {
                    // 에러 응답 본문도 출력
                    const errorText = await response.text();
                    historyList.innerHTML = `<p>서버 오류 또는 인증 오류가 발생했습니다.<br>상태코드: ${response.status}<br>메시지: ${errorText || '없음'}</p>`;
                    console.error('TTS 히스토리 API 오류:', response.status, errorText);
                }
            } catch (error) {
                console.error('TTS 히스토리 로드 실패:', error);
            } finally {
                showLoading(false);
            }
        }

        // 음성 모델 삭제
        async function deleteVoice(voiceId, voiceName) {
            if (!confirm(`정말로 음성 모델 "${voiceName}"을 삭제하시겠습니까?\n\n⚠️ 삭제된 음성 모델은 복구할 수 없습니다.`)) return;
            showLoading(true);
            try {
                const response = await fetch(`${API_BASE}/voices/${voiceId}`, { method: 'DELETE' });
                if (response.ok) {
                    showResult('voicesResult', true, `음성 모델 "${voiceName}"이 삭제되었습니다.`);
                    // 목록 새로고침
                    if (document.getElementById('voicesList').innerHTML.includes('cloned')) {
                        loadUserVoices();
                    } else {
                        loadVoices();
                    }
                } else {
                    const errorData = await response.json();
                    showResult('voicesResult', false, `삭제에 실패했습니다: ${errorData.message || '알 수 없는 오류'}`);
                }
            } catch (error) {
                showResult('voicesResult', false, '삭제 중 오류 발생: ' + error.message);
            } finally {
                showLoading(false);
            }
        }

        // TTS 히스토리 항목 삭제
        async function deleteTtsHistoryItem(historyItemId) {
            if (!confirm('정말로 이 TTS 음성 파일을 삭제하시겠습니까?')) return;
            showLoading(true);
            try {
                const response = await fetch(`${API_BASE}/history/${historyItemId}`, { method: 'DELETE' });
                if (response.ok) {
                    showResult('historyResult', true, '삭제되었습니다.');
                    loadTtsHistory();
                } else {
                    showResult('historyResult', false, '삭제에 실패했습니다.');
                }
            } catch (error) {
                showResult('historyResult', false, '삭제 중 오류 발생');
            } finally {
                showLoading(false);
            }
        }
    </script>
</body>
</html> 